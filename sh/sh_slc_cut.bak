#!/bin/sh

# Name:
#   sh_slc_cut
#   

# Purpose:
#   

# Example:
#   

# Modifications:
#   

# Algorigthm:
#   

# Dependency:
#   

PROG=sh_slc_cut



path=./raw
opath=./raw.cut
file_roi=
region_cut= #e.g., 15000/21000/000/2000


while [ "$1" != "" ]; do
  case $1 in
	  -file)
	    file_roi=$2
	    ;;
    -opath)
      opath=$2
      ;;
	  *)
	    echo "[$PROG]ERROR: invalid option ($1)!!"
	    exit 1
	    ;;
	esac
  shift 2
done

if [ "$file_roi" == "" -a "$region_cut" == "" ]; then
  echo "[$PROG]ERROR: at least one type of range MUST be given!!"
  echo "[$PROG]        1).ROI file (-file roi.kml)"
  echo "[$PROG]        2).rectangular ranges (XMIN/XMAX/YMIN/YMAX)"
  exit 1
fi


echo path $path 
echo opath $opath
echo file_roi $file_roi
echo region_cut $region_cut

mkdir -p $opath

if [ "$region_cut" == "" ]; then

  kml2gmt $file_roi > ${opath}/.tmp1
  cat ${opath}/.tmp1 |grep -v '>' | awk '{print $1,$2,0}'>  ${opath}/.roi.llh
  cat ${opath}/.roi.llh
  
  cd $opath
  ln -s ../topo/trans.dat .
  
  proj_ll2ra_ascii.csh trans.dat .roi.llh .roi.xyz
  cat .roi.xyz
  #cat .roi.xy | awk '{print $2,$1}' > .roi.xy2
  
  #exit
  
#  files=`find ../${path} -name "corr_cut.grd"`
#  file=`echo $files | awk '{print $1}'`
#  echo file $file
#  if [ "$file" == "" ]; then
    pI=-I4/1
#  else 
#    pI=`grdinfo -I $file`
#  fi
  echo pI $pI
  region_cut=`gmt gmtinfo $pI .roi.xyz`
  cd ..
else
  region_cut="-R${region_cut}"
fi
echo "region_cut $region_cut"


cd $path
files=`ls S1_*ALL*.PRM`
for file in $files ; do
  echo $file
  bname=`basename $file | sed -e 's/.PRM//g'`
  ofile="../${opath}/${bname}"
  echo cut_slc $file _tmp1 $region_cut
  echo cut_slc $file _tmp1 $region_cut | sh

  \mv -f _tmp1.PRM ${ofile}.PRM
  \mv -f _tmp1.SLC ${ofile}.SLC
  \cp -fp ${bname}.LED ../${opath}/
  exit
done

