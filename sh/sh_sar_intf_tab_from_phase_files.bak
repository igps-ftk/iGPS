#!/bin/sh

# Name:
#   sh_intf_tab_extract_by_list
#   

# Purpose:
#   

# Example:
#   

# Modifications:
#   

# Algorigthm:
#   

# Dependency:
#   
prog=sh_intf_tab_from_phase_files

#files=`ls intf_all_los_ll_png/*.png`
files=`ls intf_all_los_ll_png/*.*`
nf=`ls intf_all_los_ll_png/*.* | wc -l`
echo "total files #: $nf"

rm -rf intf.tab

ntot=$nf
np=`echo $ntot | awk '{print int($1/10)}'`
if [ $np -eq 0 ]; then
  np=1
fi
n=0

nerr=0
for file in $files; do
    #echo $file

    n=`expr $n + 1`
    #echo $n $np $ntot
    #echo $n $np | awk '{if( ($1-int($1/$2)*$2)==0){printf(".")}}'
    echo $n $np | awk '{if( ($1-int($1/$2)*$2)==0){printf("\b:>")}}'
    #sleep .5

    id=`basename $file | awk -F- '{print $1}'`
    #echo $id
    tmp=`cat intf.tab1 |grep $id|head -1`
    if [ "$tmp" = "" ]; then
      #echo "[${prog}]WARNING: not found for $id !!"
      nerr=`expr $nerr + 1`
      continue
    #else
      #echo "result is: $tmp"
    fi
    echo $tmp >> intf.tab
done

cat intf.tab | awk -F\/ '{print $3}' | awk -F_ '{print $1}' > a
cat intf.tab | awk -F\/ '{print $3}' | awk -F_ '{print $2}' >> a
sort a |uniq > a1

rm -rf scene.tab
while read line; do
    cat scene.tab1 | grep $line >> scene.tab
done < a1

if [ $nerr -gt 0 ]; then
  echo "[${prog}]WARNING: $nerr interferograms not used!"
fi
wc -l *.tab
