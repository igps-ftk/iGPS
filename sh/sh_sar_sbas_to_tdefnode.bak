#!/bin/sh

# Name:
#   sh_sar_sbas_to_tdefnode
#   

# Purpose:
#   

# Example:
#   

# Modifications:
#   

# Algorigthm:
#   

# Dependency:
#   


PROG=sh_sar_sbas_to_tdefnode

path_old=`pwd`

usage(){
  echo "[$PROG]Usage: ${PROG} "
  echo "[$PROG]Usage: e.g.,"
  echo "[$PROG]Usage:  "
}

nline_out=2000
ofile=

while [ "$1" != "" ]; do
  case $1 in
    -n|-nline)
      nline_out=$2
      ;;      
    -o|-ofile)
      ofile=$2
      ;;
    *)
      echo "[$PROG]ERROR: invalid option ($1)!!"
      usage
      exit 1
      ;;
  esac
  shift 2  
done

if [ "$ofile" == "" ]; then
  ofile=vel_mask_ll3.xyuzevvv
fi

if [ ! -s look_mask_ll3.xyz ]; then
  echo "[$PROG]ERROR: file look_mask_ll3.xyz not exist!!"
  exit 1
fi

if [ -s vel_mask_ll3.xyz -a -s rms_mask_ll3.xyz ]; then
  paste vel_mask_ll3.xyz rms_mask_ll3.xyz look_mask_ll3.xyz  | awk '{print $1,$2,$9*.001,$3,$6,$10,$11,$12}' > ${ofile}
else
  if [ -s vel_mask_ll3.xyze ]; then
    paste vel_mask_ll3.xyze look_mask_ll3.xyz  | awk '{print $1,$2,$7*.001,$3,$4,$8,$9,$10}' > ${ofile}
  else
    echo "[$PROG]ERROR: file vel_mask_ll3.xyze (or vel_mask_ll3.xyz and rms_mask_ll3.xyz) not exist!!"
    exit 1
  fi
fi

shuf ${ofile} | head -${nline_out} | sort | uniq > ${ofile}.${nline_out}
